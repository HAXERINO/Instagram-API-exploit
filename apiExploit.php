<?php
	header('Content-Type: application/json');

	class instagram
	{
		function __construct($username)
		{
			$this->username = $username;
			$this->api_url = 'https://i.instagram.com/api/v1/users/lookup/';
		}

		function generateGuid() 
		{
		    return sprintf('%04x%04x-%04x-%04x-%04x-%04x%04x%04x', mt_rand(0, 65535), mt_rand(0, 65535), mt_rand(0, 65535), mt_rand(16384, 20479), mt_rand(32768, 49151), mt_rand(0, 65535), mt_rand(0, 65535), mt_rand(0, 65535));
		}

		function generateSignature($data) 
		{
		    return hash_hmac('sha256', $data, 'b4a23f5e39b5929e0666ac5de94c89d1618a2916');
		}

		function generateUserAgent() {
		    $resolutions = array('720x1280', '320x480', '480x800', '1024x768', '1280x720', '768x1024', '480x320');
		    $versions = array('GT-N7000', 'SM-N9000', 'GT-I9220', 'GT-I9100');
		    $dpis = array('120', '160', '320', '240');
		    $ver = $versions[array_rand($versions)];
		    $dpi = $dpis[array_rand($dpis)];
		    $res = $resolutions[array_rand($resolutions)];
		    return 'Instagram 5.' . mt_rand(1, 2) . '.' . mt_rand(0, 2) . ' Android (' . mt_rand(10, 11) . '/' . mt_rand(1, 3) . '.' . mt_rand(3, 5) . '.' . mt_rand(0, 5) . '; ' . $dpi . '; ' . $res . '; samsung; ' . $ver . '; ' . $ver . '; smdkc210; en_US)';
		}

		function logRequest($data)
		{
			$file = 'igLogs.txt';
			$current = file_get_contents($file);
			$current .= date("Y-m-d H:i:s") . ": " . $data . "\n";
			file_put_contents($file, $current);
		}

		function executePost()
		{
			$guid = $this->generateGuid();
			$device_id = 'android-' . $guid;
			$data = '{"_csrftoken":"f0CpCpAnZuPl7SBl2AofrEInYUyszfaQ","q":"' . $this->username . '","guid":"' . $guid . '","device_id":"' . $device_id . '"}';
			$sig = $this->generateSignature($data);

			$ch = curl_init(); 
			curl_setopt($ch, CURLOPT_URL, $this->api_url); 
			curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
			curl_setopt($ch, CURLOPT_USERAGENT, $this->generateUserAgent());
			curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
		    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
		    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
		    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
		    curl_setopt($ch, CURLOPT_POSTFIELDS, 'signed_body=' . $sig . '.' . urlencode($data) . '&ig_sig_key_version=4');
			$output = curl_exec($ch); 
			curl_close($ch);

			return $output;
		}
	}

	$username = $_GET['user'];
	$insta = new instagram($username);
	$insta_response = $insta->executePost();

	echo $insta_response;

?>